# Example ESPHome configuration using VL6180X sensor

# Load the custom component
external_components:
  - source: github://Nick6464/vl6180x-esphome
    components: [ vl6180x ]

esphome:
  name: "vl6180x-test"
  friendly_name: VL6180X Test

esp32:
  board: esp32dev
  framework:
    type: arduino

logger:
  level: DEBUG

api:
ota:
  - platform: esphome

wifi:
  ssid: !secret wifi_ssid
  password: !secret wifi_password

# I2C configuration
i2c:
  sda: GPIO21
  scl: GPIO22
  scan: true
  frequency: 400kHz

# VL6180X sensor
sensor:
  - platform: vl6180x
    name: "ToF Distance"
    id: tof_distance
    update_interval: 2s
    filters:
      - sliding_window_moving_average:
          window_size: 5
          send_every: 1
    on_value:
      then:
        - logger.log:
            format: "Distance: %.0f mm"
            args: ['x']

# Example: Convert to water level percentage
  - platform: template
    name: "Water Level Percentage"
    unit_of_measurement: "%"
    accuracy_decimals: 0
    lambda: |-
      // Assume sensor at 200mm from empty, 50mm from full
      float max_distance = 200.0;  // Empty level
      float min_distance = 50.0;   // Full level
      float current = id(tof_distance).state;
      
      if (isnan(current)) return {};
      
      // Calculate percentage (inverted - closer = more full)
      float percent = 100.0 - ((current - min_distance) / (max_distance - min_distance) * 100.0);
      
      // Clamp to 0-100%
      if (percent < 0) percent = 0;
      if (percent > 100) percent = 100;
      
      return percent;
    update_interval: 2s

